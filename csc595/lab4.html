<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="js/parseCsv.js"></script>
    <script type="text/javascript" src="js/flareData.js"></script>
    <script type="text/javascript" src="js/bubbles_cord.js"></script>
    <script type="text/javascript" src="js/bar_cord.js"></script>
    <link rel="stylesheet" href="css/lab3.css">
    <title>Lab 4</title>
</head>
<body>

<svg class="center-clear" id="bubbles" width="960" height="960" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
<svg class="center-clear" id="barSvg" width="960" height="500"></svg>

    <script>

        var bubblesSvg = d3.select("#bubbles"),
            barSvg = d3.select("#barSvg");
        var bubblesCsvData = parseCsv(flareData);

        function csvToBubbles(csvData){
            var root = d3.hierarchy({children: csvData})
                .sum(function (d) {
                    return d.value;
                })
                .each(function (d) {
                    if (id = d.data.id) {
                        var id, i = id.lastIndexOf(".");
                        d.id = id;
                        d.package = id.slice(0, i);
                        d.class = id.slice(i + 1);
                    }
                });
            return root;
        }

        function getSiblingData(node, searchStr) {
            // separate the piece of the search path we're looking for from the rest
            var firstSep = searchStr.indexOf(".");
            //var remainder = searchStr.substring(firstSep + 1);
            var searchChild = searchStr.split(".")[1];
            var similar = [];

            // look at all the children to find the search string and recurse
            for (var iChild = 0; iChild < node.children.length; iChild++) {
                var child = node.children[iChild];
                //var lastChildSplit = child.data.path.split("/").slice(-1)[0];
                var lastChildSplit = child.id.split(".").slice(1)[0]
                if (lastChildSplit == searchChild) {

                    similar.push(child)}
            }
            return similar;
        }
//        //drawBarChart("data/barData.tsv", "#barSvg");
//        bar_cord(barSvg,[{letter:"a", frequency:.11},
//            {letter:"b", frequency:.2},
//            {letter:"c", frequency:.4},
//            {letter:"d", frequency:.8},
//            {letter:"e", frequency:.16},
//            {letter:"f", frequency:.32}])

        var bubbleData = csvToBubbles(bubblesCsvData);
        BC = BarViz();
        BV = BubblesViz();
        BV.bubbles_cord(bubblesSvg, bubbleData);
        BV.dispatch.on("selected",
            function(selectedPath) { BC.bar_cord(barSvg,
                getSiblingData(bubbleData, selectedPath)) } )

//        BC.bar_cord(barSvg, [{id:"a", value:.11},
//            {id:"b", value:.2},
//            {id:"c", value:.4},
//            {id:"d", value:.8},
//            {id:"e", value:.16},
//            {id:"f", value:.32}]);


    </script>

</body>
</html>